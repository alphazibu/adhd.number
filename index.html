<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Focus Density</title>
<style>
:root{--main:#7cfbff;}
body{
  margin:0;height:100vh;overflow:hidden;
  display:flex;justify-content:center;align-items:center;
  background:#020808;color:#fff;font-family:system-ui;
}
/* 背景が真っ黒にならないよう、デフォルトでグラデーションを設定 */
#bg{
  position:absolute;inset:0;
  background: radial-gradient(circle at center, #1a2a6c, #b21f1f, #fdbb2d);
  background-size: 200% 200%;
  filter:blur(100px);z-index:-3;
  opacity: 0.5;
}
canvas{position:absolute;inset:0;z-index:-2}
.card{text-align:center;position:relative}
.count{font-size:8rem;font-weight:100;letter-spacing:-2px;margin:0}
.rank{font-size:2rem;margin-top:20px;color:var(--main);font-weight:bold}
</style>
</head>
<body>

<div id="bg"></div>
<canvas id="c"></canvas>

<div class="card">
  <div class="count" id="countDisplay">0</div>
  <div class="rank" id="rankDisplay">×1</div>
</div>

<script type="module">
import { createGuard } from "./guard.js";

// --- 初期設定 ---
if(!localStorage.uid) localStorage.uid = "u"+Math.random().toString(36).slice(2);
const uid = localStorage.uid;
const guard = createGuard({}, uid);

let countVal = localStorage.countVal ? parseFloat(localStorage.countVal) : 0;
let lastUpdate = Date.now();

// --- 数値更新ループ ---
function updateLoop() {
  const now = Date.now();
  const dt = (now - lastUpdate) / 1000;
  lastUpdate = now;

  countVal += dt;
  localStorage.countVal = countVal;

  // 画面に数値を反映
  document.getElementById("countDisplay").textContent = Math.floor(countVal).toLocaleString();
  document.getElementById("rankDisplay").textContent = "×" + (Math.floor(countVal / 10000) + 1);
  
  requestAnimationFrame(updateLoop);
}
updateLoop();

// --- 3秒ごとにセキュリティチェック ---
setInterval(() => {
  guard.secureSend(countVal);
}, 3000);

// --- 背景粒子アニメーション ---
const cv=document.getElementById("c");
const ctx=cv.getContext("2d");
function resize(){cv.width=window.innerWidth;cv.height=window.innerHeight}
window.onresize=resize; resize();

let pts = Array(80).fill().map(()=>({
  x:Math.random()*cv.width, 
  y:Math.random()*cv.height, 
  vx:(Math.random()-0.5)*0.5, 
  vy:(Math.random()-0.5)*0.5
}));

function draw() {
  ctx.clearRect(0,0,cv.width,cv.height);
  ctx.fillStyle="rgba(255,255,255,0.3)";
  pts.forEach(p=>{
    p.x+=p.vx; p.y+=p.vy;
    if(p.x<0||p.x>cv.width)p.vx*=-1;
    if(p.y<0||p.y>cv.height)p.vy*=-1;
    ctx.fillRect(p.x,p.y,2,2);
  });
  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
