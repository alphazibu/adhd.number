<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Focus Density</title>

<style>
:root{--main:#7cfbff}
body{
margin:0;height:100vh;overflow:hidden;
display:flex;justify-content:center;align-items:center;
background:#020808;color:#fff;font-family:system-ui
}
#bg{position:absolute;inset:0;filter:blur(160px);z-index:-3}
canvas{position:absolute;inset:0;z-index:-2}
.card{text-align:center}
.count{font-size:9rem;font-weight:100;line-height:1}
.glow{text-shadow:0 0 35px var(--main)}
.rank{margin-top:10px;opacity:.6}
</style>
</head>

<body>
<div id="bg"></div>
<canvas id="c"></canvas>

<div class="card">
  <div class="count" id="count">0</div>
  <div class="rank" id="rank">- / -</div>
</div>

<script>
const RANKING_URL = "./ranking.json";
const MY_ID = "global"; // 入力なし固定
let count = 0;

/* カウント進行 */
setInterval(()=>{
  count++;
  countEl.textContent = count.toLocaleString();
  countEl.classList.add("glow");
  setTimeout(()=>countEl.classList.remove("glow"),120);
},1000);

/* ランキング取得（疑似リアルタイム） */
async function updateRank(){
  try{
    const res = await fetch(RANKING_URL+"?t="+Date.now());
    const json = await res.json();
    const users = {...json.users,[MY_ID]:count};
    const sorted = Object.entries(users)
      .sort((a,b)=>b[1]-a[1]);
    const r = sorted.findIndex(v=>v[0]===MY_ID)+1;
    rank.textContent = (r>0?r:"-")+" / "+sorted.length;
  }catch(e){}
}

setInterval(updateRank,5000);
updateRank();

/* 背景演出 */
const ctx=c.getContext("2d");
c.width=innerWidth;c.height=innerHeight;
let ps=[...Array(120)].map(()=>({
  x:Math.random()*c.width,
  y:Math.random()*c.height,
  vx:(Math.random()-.5)*.3,
  vy:(Math.random()-.5)*.3
}));

(function loop(){
  ctx.clearRect(0,0,c.width,c.height);
  ps.forEach(p=>{
    p.x+=p.vx;p.y+=p.vy;
    if(p.x<0||p.x>c.width)p.vx*=-1;
    if(p.y<0||p.y>c.height)p.vy*=-1;
    ctx.fillStyle="rgba(255,255,255,.6)";
    ctx.fillRect(p.x,p.y,2,2);
  });
  requestAnimationFrame(loop);
})();
</script>

</body>
</html>
